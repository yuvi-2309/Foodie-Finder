<div class="restaurant-detail-container">
  @if (isLoading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Loading restaurant details...</p>
    </div>
  } @else if (restaurant()) {
    <button mat-icon-button class="back-button" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
    </button>

    <div class="restaurant-header">
      <div class="header-image" [style.background-image]="'url(' + (restaurant()!.imageUrl || 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=800') + ')'"></div>
      
      <div class="header-content">
        <div class="title-section">
          <h1>{{ restaurant()!.name }}</h1>
          @if (restaurant()!.priceRange !== undefined) {
            <div class="price-badge">{{ getPriceRange(restaurant()!.priceRange!) }}</div>
          }
        </div>
        
        @if (restaurant()!.cuisine) {
          <mat-chip-set class="cuisine-chip">
            <mat-chip>{{ restaurant()!.cuisine }}</mat-chip>
          </mat-chip-set>
        }
        
        @if (restaurant()!.totalReviews !== undefined && restaurant()!.totalReviews! > 0) {
          <div class="rating-section">
            <div class="stars">
              @for (star of getStarArray(restaurant()!.averageRating || 0); track $index) {
                <mat-icon [class.filled]="star === 1">star</mat-icon>
              }
            </div>
            <span class="rating-text">
              {{ restaurant()!.averageRating || 0 | number: '1.1-1' }} out of 5 ({{ restaurant()!.totalReviews }} reviews)
            </span>
          </div>
        }
        
        @if (restaurant()!.description) {
          <p class="description">{{ restaurant()!.description }}</p>
        }
      </div>
    </div>

    <mat-card class="info-card">
      <mat-card-content>
        <div class="info-grid">
          <div class="info-item">
            <mat-icon>location_on</mat-icon>
            <div>
              <strong>Address</strong>
              <p>{{ restaurant()!.address || restaurant()!.location || 'Not available' }}</p>
            </div>
          </div>
          
          @if (restaurant()!.phone) {
            <div class="info-item">
              <mat-icon>phone</mat-icon>
              <div>
                <strong>Phone</strong>
                <p>{{ restaurant()!.phone }}</p>
              </div>
            </div>
          }
          
          @if (restaurant()!.website) {
            <div class="info-item">
              <mat-icon>language</mat-icon>
              <div>
                <strong>Website</strong>
                <p><a [href]="'https://' + restaurant()!.website" target="_blank">{{ restaurant()!.website }}</a></p>
              </div>
            </div>
          }
        </div>
      </mat-card-content>
    </mat-card>

    <div class="reviews-section">
      <div class="reviews-header">
        <h2>Reviews ({{ reviews().length }})</h2>
        <button mat-raised-button color="primary" (click)="toggleReviewForm()">
          <mat-icon>rate_review</mat-icon>
          Write a Review
        </button>
      </div>

      @if (showReviewForm()) {
        <app-review-form
          [restaurantId]="restaurantId()"
          (reviewSubmitted)="onReviewSubmitted($event)"
        ></app-review-form>
      }

      <mat-divider></mat-divider>

      @if (reviews().length === 0) {
        <div class="no-reviews">
          <mat-icon>rate_review</mat-icon>
          <h3>No reviews yet</h3>
          <p>Be the first to share your experience!</p>
        </div>
      } @else {
        <div class="reviews-list">
          @for (review of reviews(); track review.id) {
            <mat-card class="review-card">
              <mat-card-header>
                <div class="review-header-content">
                  <div class="user-info">
                    <div class="avatar">
                      @if (review.userAvatar) {
                        <img [src]="review.userAvatar" [alt]="review.username || 'User'" />
                      } @else {
                        <mat-icon>account_circle</mat-icon>
                      }
                    </div>
                    <div>
                      <strong>{{ review.username || 'Anonymous' }}</strong>
                      @if (review.createdAt) {
                        <p class="review-date">{{ formatDate(review.createdAt) }}</p>
                      }
                    </div>
                  </div>
                  
                  <div class="stars small">
                    @for (star of getStarArray(review.rating); track $index) {
                      <mat-icon [class.filled]="star === 1">star</mat-icon>
                    }
                  </div>
                </div>
              </mat-card-header>
              
              <mat-card-content>
                @if (review.title) {
                  <h3>{{ review.title }}</h3>
                }
                <p class="review-content">{{ review.content }}</p>
                @if (review.visitDate) {
                  <p class="visit-date">Visited on {{ formatDate(review.visitDate) }}</p>
                }
              </mat-card-content>
              
              <mat-card-actions>
                @if (review.helpfulCount !== undefined) {
                  <button mat-button>
                    <mat-icon>thumb_up</mat-icon>
                    Helpful ({{ review.helpfulCount }})
                  </button>
                }
              </mat-card-actions>
            </mat-card>
          }
        </div>
      }
    </div>
  }
</div>
