<mat-card class="review-form-card">
  <mat-card-header>
    <mat-card-title>Write a Review</mat-card-title>
    <mat-card-subtitle>Share your experience with the community</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <form [formGroup]="reviewForm" (ngSubmit)="onSubmit()">
      <div class="rating-input">
        <label>Your Rating *</label>
        <div
          class="stars"
          (mouseleave)="clearHoverRating()"
        >
          @for (star of [1, 2, 3, 4, 5]; track star) {
            <mat-icon
              (click)="setRating(star)"
              (mouseenter)="setHoverRating(star)"
              [class.selected]="star <= selectedRating()"
            >
              {{ getStarIcon(star) }}
            </mat-icon>
          }
        </div>
        @if (selectedRating() === 0) {
          <span class="rating-hint">Click to rate</span>
        } @else {
          <span class="rating-selected">{{ selectedRating() }} out of 5 stars</span>
        }
      </div>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Your Review</mat-label>
        <textarea
          matInput
          formControlName="content"
          rows="5"
          placeholder="What did you love? What could be better? Help others by sharing your experience..."
        ></textarea>
        @if (getErrorMessage('content')) {
          <mat-error>{{ getErrorMessage('content') }}</mat-error>
        }
      </mat-form-field>

      <!-- Photo Upload Section -->
      <div class="photo-section">
        <label class="photo-label">
          <mat-icon>add_a_photo</mat-icon>
          Add a Photo (optional)
        </label>

        @if (!photoPreview() && !cloudinaryService.isUploading()) {
          <div class="upload-area">
            <input
              type="file"
              accept="image/jpeg,image/png,image/gif,image/webp"
              (change)="onFileSelected($event)"
              #fileInput
              hidden
            />
            <button
              mat-stroked-button
              type="button"
              class="upload-btn"
              (click)="fileInput.click()"
            >
              <mat-icon>cloud_upload</mat-icon>
              Choose Image
            </button>
            <span class="upload-hint">JPEG, PNG, GIF, or WebP (max 5MB)</span>
          </div>
        }

        @if (cloudinaryService.isUploading()) {
          <div class="upload-progress">
            <mat-progress-bar mode="indeterminate" color="primary"></mat-progress-bar>
            <span class="upload-status">Uploading image...</span>
          </div>
        }

        @if (uploadError()) {
          <div class="upload-error">
            <mat-icon>error_outline</mat-icon>
            <span>{{ uploadError() }}</span>
          </div>
        }

        @if (photoPreview() && !cloudinaryService.isUploading()) {
          <div class="photo-preview">
            <img [src]="photoPreview()" alt="Photo preview" />
            <button mat-icon-button class="remove-photo" (click)="clearPhoto()" type="button">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        }
      </div>

      <div class="form-actions">
        @if (isSubmitting()) {
          <button mat-raised-button color="primary" type="submit" disabled>
            <mat-icon class="spin">sync</mat-icon>
            Submitting...
          </button>
        } @else {
          <button mat-raised-button color="primary" type="submit">
            <mat-icon>send</mat-icon>
            Submit Review
          </button>
        }
      </div>
    </form>
  </mat-card-content>
</mat-card>
